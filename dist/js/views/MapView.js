define(["jquery","underscore","backbone","models/Location","collections/Locations","text!templates/home.html"],function(e,t,n,r,i,s){var o=n.View.extend({el:e("#map"),initialize:function(){t.bindAll(this,"resetMap","addMarker","zoomIn"),this.event_aggregator.bind("map:resetMap",this.resetMap),this.event_aggregator.bind("map:addMarker",this.addMarker),this.event_aggregator.bind("map:zoomIn",this.zoomIn)},initMap:function(){console.log("Drawing map ..."),this.center=new google.maps.LatLng(40.4167754,-3.7037902);var e={center:this.center,zoom:2,disableDefaultUI:!0,mapTypeId:google.maps.MapTypeId.ROADMAP};this.map=new google.maps.Map(this.$el[0],e)},resetMap:function(e){this.center=e,this.map.setCenter(e),this.map.setZoom(8)},addMarker:function(e){var t=this,n={map:this.map,draggable:!0,animation:google.maps.Animation.DROP,position:this.center,title:"Show pictures of "+e.get("formatted_address"),icon:"img/photo-marker.png",shadow:"img/photo-marker-shadow.png"};this.marker=new google.maps.Marker(n),google.maps.event.addListener(t.marker,"click",function(){t.event_aggregator.trigger("location:loadPictures",e)}),google.maps.event.addListener(t.marker,"dragend",function(){var e=new google.maps.Geocoder,n={location:t.marker.getPosition()};e.geocode(n,function(e,n){var i=e[0],s=new r;s.setData(i),t.resetMap(t.marker.getPosition()),t.resetMarker({title:s.get("formatted_address")},s),t.event_aggregator.trigger("location:loadPictures",s)})})},resetMarker:function(e,t){var n=this;this.marker.setOptions(e),google.maps.event.clearListeners(n.marker,"click"),google.maps.event.addListener(n.marker,"click",function(){n.event_aggregator.trigger("location:loadPictures",t)})},zoomIn:function(){this.map.setZoom(14),this.map.setCenter(this.center)},render:function(){return this.initMap(),this.$el}});return o});